//
//  EntityData.unit.test.js
//
//  Created by Julien Merzoug on 31 May 2022.
//  Copyright 2022 Vircadia contributors.
//  Copyright 2022 DigiSomni LLC.
//
//  Distributed under the Apache License, Version 2.0.
//  See the accompanying file LICENSE or http://www.apache.org/licenses/LICENSE-2.0.html
//

import Uuid from "../../../../src/domain/shared/Uuid";
import EntityData from "../../../../src/domain/networking/packets/EntityData";


describe("EntityData - unit tests", () => {

    /* eslint-disable @typescript-eslint/no-magic-numbers */


    test("Can read an EntityData packet", () => {
        // eslint-disable-next-line max-len
        const bufferHex = "129c5c8e057a4db3b38f7bb0a1306646400000003075dc050000253aac36e005000062fff8ffff37ffffffffffffe03fa0110000000000000000000000000000000000000000ffff011e004578706c6f7265204d61726b657220286d795f6c6f63616c5f746f776e29009a007b226f776e6572223a224a7575222c22646f6d61696e4e616d65223a226d795f6c6f63616c5f746f776e222c22706f7274223a223430313032222c22697041646472657373223a6e756c6c2c22617661746172436f756e74526164697573223a6e756c6c2c22637573746f6d50617468223a6e756c6c2c22677261626261626c654b6579223a7b22677261626261626c65223a66616c73657d7d00000000000000000000ca34793f000080bfcdcccc3dcdcccc3dcdcccc3dff7fff7fff7fffff0000003f0000003f0000003f0000003075dc05001000f7191522b4674a6fac996293280640b3ac5cb1bd3409633fcb158bbfac5c313e01000000000000000000000000000000000101000001000000000000000000000000ff7fff7fff7fffff000000000000000000000000ff7fff7fff7fffff00000000803f0000803f0000803f00000000000000000000000000007a44000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e674c93ee674c93e0000003f0000003f000080bf011f0000000000000000009643000000000000000000000000000000000000520068747470733a2f2f6d65746176657273652e76697263616469612e636f6d2f696e746572696d2f642d676f746f2f6170702f646563656e7472616c697a6564476f546f5365727665725363726970742e6a7300000000000000000000ffffffff000000000000000000000000000000000000ff00000000803f000000000000803f0000803f0000000000000000040043756265";

        const bufferArray = new Uint8Array(bufferHex.match(/[\da-f]{2}/giu).map(function (hex) {
            return parseInt(hex, 16);
        }));
        const data = new DataView(bufferArray.buffer);

        const info = EntityData.read(data);
        expect(info.id).toStrictEqual(new Uuid(24737979467837812737759002455400539718n));
        expect(info.entityType).toBe(4);

        // TODO: Check other properties.

    });

});
