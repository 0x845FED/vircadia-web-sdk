//
//  SetAvatarTraits.unit.test.js
//
//  Created by Julien Merzoug on 12 Apr 2022.
//  Copyright 2022 Vircadia contributors.
//  Copyright 2022 DigiSomni LLC.
//
//  Distributed under the Apache License, Version 2.0.
//  See the accompanying file LICENSE or http://www.apache.org/licenses/LICENSE-2.0.html
//

import { ClientTraitStatus } from "../../../../src/domain/avatars/ClientTraitsHandler";
import SetAvatarTraits from "../../../../src/domain/networking/packets/SetAvatarTraits";
import PacketType from "../../../../src/domain/networking/udt/PacketHeaders";
import UDT from "../../../../src/domain/networking/udt/UDT";
import NLPacketList from "../../../../src/domain/networking/NLPacketList";

import { buffer2hex } from "../../../testUtils.js";


describe("SetAvatarTraits - unit tests", () => {

    test("Can write a SetAvatarTraits packet for an initial send", () => {

        // eslint-disable-next-line max-len
        const EXPECTED_PACKET = "00000060000000000000000019160000000000000000000000000000000000000100000000420068747470733a2f2f63646e2d312e76697263616469612e636f6d2f75732d652d312f42617a6161722f417661746172732f5365616e2f6662782f5365616e2e667374";
        const traitStatuses = [ClientTraitStatus.Unchanged];
        const packetList = SetAvatarTraits.write({
            currentTraitVersion: 1,
            skeletonModelURL: "https://cdn-1.vircadia.com/us-e-1/Bazaar/Avatars/Sean/fbx/Sean.fst",
            traitStatuses,
            initialSend: true
        });
        packetList.closeCurrentPacket();

        expect(packetList instanceof NLPacketList).toBe(true);
        expect(packetList.getType()).toBe(PacketType.SetAvatarTraits);
        const packets = packetList.getPackets();
        expect(packets).toHaveLength(1);

        const packet = packets[0];
        const packetSize = packet.getDataSize();
        expect(packetSize).toBeGreaterThan(0);
        expect(packetSize).toBeLessThanOrEqual(UDT.MAX_PACKET_SIZE);
        expect(buffer2hex(packet.getMessageData().buffer.slice(0, packet.getMessageData().dataPosition))).toBe(EXPECTED_PACKET);
        expect(packet.getMessageData().dataPosition).toBe(EXPECTED_PACKET.length / 2);
    });

    test("Can write a SetAvatarTraits packet for an updated trait", () => {

        // eslint-disable-next-line max-len
        const EXPECTED_PACKET = "00000060000000000000000019160000000000000000000000000000000000000100000000420068747470733a2f2f63646e2d312e76697263616469612e636f6d2f75732d652d312f42617a6161722f417661746172732f5365616e2f6662782f5365616e2e667374";
        const traitStatuses = [ClientTraitStatus.Updated];
        const packetList = SetAvatarTraits.write({
            currentTraitVersion: 1,
            skeletonModelURL: "https://cdn-1.vircadia.com/us-e-1/Bazaar/Avatars/Sean/fbx/Sean.fst",
            traitStatuses,
            initialSend: false
        });
        packetList.closeCurrentPacket();

        expect(packetList instanceof NLPacketList).toBe(true);
        expect(packetList.getType()).toBe(PacketType.SetAvatarTraits);
        const packets = packetList.getPackets();
        expect(packets).toHaveLength(1);

        const packet = packets[0];
        const packetSize = packet.getDataSize();
        expect(packetSize).toBeGreaterThan(0);
        expect(packetSize).toBeLessThanOrEqual(UDT.MAX_PACKET_SIZE);
        expect(buffer2hex(packet.getMessageData().buffer.slice(0, packet.getMessageData().dataPosition))).toBe(EXPECTED_PACKET);
        expect(packet.getMessageData().dataPosition).toBe(EXPECTED_PACKET.length / 2);
    });

    test("Can write a SetAvatarTraits packet that includes skeleton data", () => {
        /* eslint-disable max-len */
        const EXPECTED_MESSAGE = "02000000010c0c3e073b448cc2a642587104000006020040b62dac37d33c47a21f7ccc0c0000ffff06000402df22813267f7b0b258a10c52cc0c0100ffff0a000402000000000000bfffbfff3fff00000200ffff0e000b02000000000000bfffbfff3fff00000300ffff19000d02000000000000bfffbfff3fff00000400ffff26000e02000000000000bfffbfff3fff00000500ffff34000f02000000000000bfffbfff3fff00000600ffff43000e02000000000000bfffbfff3fff00000700ffff51000c02000000000000bfffbfff3fff00000800ffff5d001502000000000000bfffbfff3fff00000900ffff72000b02000000000000bfffbfff3fff00000a00ffff7d000402000000000000bfffbfff3fff20000b00ffff810004010000530878ffbfffbfff3fff20000c000b0085000a0105fff7ff00003fffbfff3fff20000d000c008f0008010000ab0300003fffbfff3fff20000e000d00970009010000ab03000040068de5400d20000f000e00a0000c01000051010000c00202304002200010000f00ac00100100009d000000c00202304002200011001000bc000901fb00f7ff00003fffbfff3fff200012000c00c50007010000ab0300003fffbfff3fff200013001200cc0008010000ab0300003ffb8e3c3ff6200014001300d4000b01000051010000bffd02263ffd200015001400df000f0100009e000000bffd02263ffd200016001500ee0005010000c3000000bfffbfff3fff200017000c00f300060100002f010000bfffbfff3fff200018001700f900060100002d010000bfffbfff3fff200019001800ff0004010000c8010000bfffbfff3fff20001a001900030104010000d3000000bfffbfff3fff20001b001a0007010f01c0ff55000e0141298ec73ecc20001c001b001601130100005500000041298ec73ecc20001d001c0029010f01400055000e013ed58ec7413220001e001b00380113010000550000003ed58ec7413220001f001e004b010f01c0ff55000e01c0bf06633e80200020001b005a011301000052000000c0bf06633e802000210020006d010f01400055000e01bf3f0663417e200022001b007c011301000052000000bf3f0663417e2000230022008f010801c0ff55000e01bfffbfff3fff200024001b0097010c010000c62a0000bfffbfff3fff200025002400a3010701400055000e01bfffbfff3fff200026001b00aa010b010000c62a0000bfffbfff3fff200027002600b5010d01ceff33012b0092beed4012be200028001900c201080100006301000092beed4012be200029002800ca010c0100002f02000092beed4012be20002a002900d601090100004502000090b7eb2014de20002b002a00df010f0130005f000100853fd95f269f20002c002b00ee010f0100004900000088c4e0541faa20002d002c00fd010f01000056000000852dd93526c920002e002d000c021301000041000000852dd93526c920002f002e001f020e01bdffdb00ecffeb666f076b66200030002b002d020e01000047000000ebaa6ec86baa2000310030003b020e0100003a000000149def0c149d2000320031004902120100003e000000149def0c149d2000330032005b020f0199ffc600ffffe7b9722c67b9200034002b006a020f0100003100000017d1f1cf17d120003500340079020f010000240000001831f21c18312000360035008802130100002e0000001831f21c18312000370036009b021001e9ffef00e8ff91f6ec74138a200038002b00ab021001000051000000923decbe1340200039003800bb02100100004000000091e9ec66139820003a003900cb02140100003f00000091e9ec66139820003b003a00df020f012100f800f0ff8fddea2d15d120003c002b00ee020f0100003d0000008f89e9cb163320003d003c00fd020f010000370000009081eae5151920003e003d000c03130100003e0000009081eae5151920003f003e001f030c01320033012b0092be92be6d402000400019002b03070100006301000092a792d56d2920004100400032030b0100002f02000092be92be6d402000420041003d030801000045020000909795016afd20004300420045030e01d0ff5f0001008524a6dc592220004400430053030e0100004900000088a39fe2601c20004500440061030e010000560000008510a70c58f22000460045006f0312010000410000008510a70c58f220004700460081030d014300db00ecff947f6ef0147f2000480043008e030d010000470000006bc6eeae6bc62000490048009b030d0100003a0000006b7eeef16b7e20004a004900a803110100003e0000006b7eeef16b7e20004b004a00b9030e016700c600ffff67cff21b67cf20004c004300c7030e0100003100000097b871bb17b820004d004c00d5030e0100002400000098157206181520004e004d00e303120100002e00000098157206181520004f004e00f5030f011700ef00e8ff91d793aa6c5420005000430004040f01000051000000921e93606c9e20005100500013040f0100004000000091cb93b76c472000520051002204130100003f00000091cb93b76c4720005300520035040e01dffff800f0ff8fc595ed6a0120005400430043040e0100003d0000008f67965969a520005500540051040e010000370000009060953e6ac02000560055005f04120100003e0000009060953e6ac020005700560043616d6572614c616d70426f647953686f727430322e6f626a486967682d706f6c792e6f626a45796562726f773031322e6f626a4579656c617368657330312e6f626a54656574685f626173652e6f626a546f6e67756530312e6f626a4d616c655f63617375616c7375697430312e6f626a53686f657330322e6f626a5365616e48697073526967687455704c656752696768744c65675269676874466f6f745269676874546f65426173655269676874546f65426173655f656e644c65667455704c65674c6566744c65674c656674466f6f744c656674546f65426173654c656674546f65426173655f656e645370696e655370696e65315370696e65324e65636b486561646f72626963756c6172697330342e526f72626963756c6172697330342e525f656e646f72626963756c6172697330342e4c6f72626963756c6172697330342e4c5f656e646f72626963756c6172697330332e526f72626963756c6172697330332e525f656e646f72626963756c6172697330332e4c6f72626963756c6172697330332e4c5f656e64526967687445796552696768744579655f656e644c6566744579654c6566744579655f656e64526967687453686f756c646572526967687441726d5269676874466f726541726d526967687448616e64526967687448616e645468756d6231526967687448616e645468756d6232526967687448616e645468756d6233526967687448616e645468756d62335f656e64526967687448616e6452696e6731526967687448616e6452696e6732526967687448616e6452696e6733526967687448616e6452696e67335f656e64526967687448616e6450696e6b7931526967687448616e6450696e6b7932526967687448616e6450696e6b7933526967687448616e6450696e6b79335f656e64526967687448616e644d6964646c6531526967687448616e644d6964646c6532526967687448616e644d6964646c6533526967687448616e644d6964646c65335f656e64526967687448616e64496e64657831526967687448616e64496e64657832526967687448616e64496e64657833526967687448616e64496e646578335f656e644c65667453686f756c6465724c65667441726d4c656674466f726541726d4c65667448616e644c65667448616e645468756d62314c65667448616e645468756d62324c65667448616e645468756d62334c65667448616e645468756d62335f656e644c65667448616e6452696e67314c65667448616e6452696e67324c65667448616e6452696e67334c65667448616e6452696e67335f656e644c65667448616e6450696e6b79314c65667448616e6450696e6b79324c65667448616e6450696e6b79334c65667448616e6450696e6b79335f656e644c65667448616e644d6964646c65314c65667448616e644d6964646c65324c65667448616e644d6964646c65334c65667448616e644d6964646c65335f656e644c65667448616e64496e646578314c65667448616e64496e646578324c65667448616e64496e646578334c65667448616e64496e646578335f656e64";
        const EXPECTED_PACKET_0 = "000000600000000000000000191600000000000000000000000000000000000002000000010c0c3e073b448cc2a642587104000006020040b62dac37d33c47a21f7ccc0c0000ffff06000402df22813267f7b0b258a10c52cc0c0100ffff0a000402000000000000bfffbfff3fff00000200ffff0e000b02000000000000bfffbfff3fff00000300ffff19000d02000000000000bfffbfff3fff00000400ffff26000e02000000000000bfffbfff3fff00000500ffff34000f02000000000000bfffbfff3fff00000600ffff43000e02000000000000bfffbfff3fff00000700ffff51000c02000000000000bfffbfff3fff00000800ffff5d001502000000000000bfffbfff3fff00000900ffff72000b02000000000000bfffbfff3fff00000a00ffff7d000402000000000000bfffbfff3fff20000b00ffff810004010000530878ffbfffbfff3fff20000c000b0085000a0105fff7ff00003fffbfff3fff20000d000c008f0008010000ab0300003fffbfff3fff20000e000d00970009010000ab03000040068de5400d20000f000e00a0000c01000051010000c00202304002200010000f00ac00100100009d000000c00202304002200011001000bc000901fb00f7ff00003fffbfff3fff200012000c00c50007010000ab0300003fffbfff3fff200013001200cc0008010000ab0300003ffb8e3c3ff6200014001300d4000b01000051010000bffd02263ffd200015001400df000f0100009e000000bffd02263ffd200016001500ee0005010000c3000000bfffbfff3fff200017000c00f300060100002f010000bfffbfff3fff200018001700f900060100002d010000bfffbfff3fff200019001800ff0004010000c8010000bfffbfff3fff20001a001900030104010000d3000000bfffbfff3fff20001b001a0007010f01c0ff55000e0141298ec73ecc20001c001b001601130100005500000041298ec73ecc20001d001c0029010f01400055000e013ed58ec7413220001e001b00380113010000550000003ed58ec7413220001f001e004b010f01c0ff55000e01c0bf06633e80200020001b005a011301000052000000c0bf06633e802000210020006d010f01400055000e01bf3f0663417e200022001b007c011301000052000000bf3f0663417e2000230022008f010801c0ff55000e01bfffbfff3fff200024001b0097010c010000c62a0000bfffbfff3fff200025002400a3010701400055000e01bfffbfff3fff200026001b00aa010b010000c62a0000bfffbfff3fff200027002600b5010d01ceff33012b0092beed4012be200028001900c201080100006301000092beed4012be200029002800ca010c0100002f02000092beed4012be20002a002900d601090100004502000090b7eb2014de20002b002a00df010f0130005f000100853fd95f269f20002c002b00ee010f0100004900000088c4e0541faa20002d002c00fd010f01000056000000852dd93526c920002e002d000c021301000041000000852dd93526c920002f002e001f020e01bdffdb00ecffeb666f076b66200030002b002d020e01000047000000ebaa6ec86baa2000310030003b020e0100003a000000149def0c149d2000320031004902120100003e000000149def0c149d2000330032005b020f0199ffc600ffffe7b9722c67b9200034002b006a020f0100003100000017d1f1cf17d120003500340079020f010000240000001831f21c18312000360035008802130100002e0000001831f21c18312000370036009b021001e9ffef00e8ff91f6ec74138a200038002b00ab021001000051000000923decbe1340200039003800bb02100100004000000091e9ec66139820003a003900cb02140100003f00000091e9ec66139820003b003a00df020f012100f800f0ff8fddea2d15d120003c002b00ee020f0100003d0000008f89e9cb163320003d003c00fd020f010000370000009081eae5151920003e003d000c03130100003e0000009081eae5151920003f003e001f030c013200";
        const EXPECTED_PACKET_1 = "000000600000000000000000191600000000000000000000000000000000000033012b0092be92be6d402000400019002b03070100006301000092a792d56d2920004100400032030b0100002f02000092be92be6d402000420041003d030801000045020000909795016afd20004300420045030e01d0ff5f0001008524a6dc592220004400430053030e0100004900000088a39fe2601c20004500440061030e010000560000008510a70c58f22000460045006f0312010000410000008510a70c58f220004700460081030d014300db00ecff947f6ef0147f2000480043008e030d010000470000006bc6eeae6bc62000490048009b030d0100003a0000006b7eeef16b7e20004a004900a803110100003e0000006b7eeef16b7e20004b004a00b9030e016700c600ffff67cff21b67cf20004c004300c7030e0100003100000097b871bb17b820004d004c00d5030e0100002400000098157206181520004e004d00e303120100002e00000098157206181520004f004e00f5030f011700ef00e8ff91d793aa6c5420005000430004040f01000051000000921e93606c9e20005100500013040f0100004000000091cb93b76c472000520051002204130100003f00000091cb93b76c4720005300520035040e01dffff800f0ff8fc595ed6a0120005400430043040e0100003d0000008f67965969a520005500540051040e010000370000009060953e6ac02000560055005f04120100003e0000009060953e6ac020005700560043616d6572614c616d70426f647953686f727430322e6f626a486967682d706f6c792e6f626a45796562726f773031322e6f626a4579656c617368657330312e6f626a54656574685f626173652e6f626a546f6e67756530312e6f626a4d616c655f63617375616c7375697430312e6f626a53686f657330322e6f626a5365616e48697073526967687455704c656752696768744c65675269676874466f6f745269676874546f65426173655269676874546f65426173655f656e644c65667455704c65674c6566744c65674c656674466f6f744c656674546f65426173654c656674546f65426173655f656e645370696e655370696e65315370696e65324e65636b486561646f72626963756c6172697330342e526f72626963756c6172697330342e525f656e646f72626963756c6172697330342e4c6f72626963756c6172697330342e4c5f656e646f72626963756c6172697330332e526f72626963756c6172697330332e525f656e646f72626963756c6172697330332e4c6f72626963756c6172697330332e4c5f656e64526967687445796552696768744579655f656e644c6566744579654c6566744579655f656e64526967687453686f756c646572526967687441726d5269676874466f726541726d526967687448616e64526967687448616e645468756d6231526967687448616e645468756d6232526967687448616e645468756d6233526967687448616e645468756d62335f656e64526967687448616e6452696e6731526967687448616e6452696e6732526967687448616e6452696e6733526967687448616e6452696e67335f656e64526967687448616e6450696e6b7931526967687448616e6450696e6b7932526967687448616e6450696e6b7933526967687448616e6450696e6b79335f656e64526967687448616e644d6964646c6531526967687448616e644d6964646c6532526967687448616e644d6964646c6533526967687448616e644d6964646c65335f656e64526967687448616e64496e64657831526967687448616e64496e64657832526967687448616e64496e64657833526967687448616e64496e646578335f656e644c65667453686f756c6465724c65667441726d4c656674466f726541726d4c65667448616e644c65667448616e645468756d62314c65667448616e645468756d62324c65667448616e645468756d62334c65667448616e645468756d62335f656e644c65667448616e6452696e6731";
        const EXPECTED_PACKET_2 = "00000060000000000000000019160000000000000000000000000000000000004c65667448616e6452696e67324c65667448616e6452696e67334c65667448616e6452696e67335f656e644c65667448616e6450696e6b79314c65667448616e6450696e6b79324c65667448616e6450696e6b79334c65667448616e6450696e6b79335f656e644c65667448616e644d6964646c65314c65667448616e644d6964646c65324c65667448616e644d6964646c65334c65667448616e644d6964646c65335f656e644c65667448616e64496e646578314c65667448616e64496e646578324c65667448616e64496e646578334c65667448616e64496e646578335f656e64";
        /* eslint-enable max-len */
        const traitStatuses = [ClientTraitStatus.Unchanged, ClientTraitStatus.Updated];
        const packetList = SetAvatarTraits.write({
            currentTraitVersion: 2,
            skeletonModelURL: "https://cdn-1.vircadia.com/us-e-1/Bazaar/Avatars/Sean/fbx/Sean.fst",
            /* eslint-disable max-len, array-element-newline, @typescript-eslint/no-loss-of-precision */
            skeletonData: [
                { "boneType": 2, "defaultRotation": { "w": 0.35922178626060486, "x": -0.2125573456287384, "y": 0.9047969579696655, "z": -0.08438940346240997 }, "defaultScale": 83.37995147705078, "defaultTranslation": { "x": 748.1131591796875, "y": 534.3665161132812, "z": 650.7639770507812 }, "jointIndex": 0, "jointName": "Camera", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 0.5709475874900818, "x": 0.1690756231546402, "y": 0.7558803558349609, "z": -0.2721712291240692 }, "defaultScale": 83.37997436523438, "defaultTranslation": { "x": 407.6245422363281, "y": 590.38623046875, "z": -100.54539489746094 }, "jointIndex": 1, "jointName": "Lamp", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 1, "x": 2.1855687037941607e-08, "y": 0, "z": 0 }, "defaultScale": 0.00833799596875906, "defaultTranslation": { "x": 0, "y": -1.2423523766852307e-21, "z": 2.842170943040401e-14 }, "jointIndex": 2, "jointName": "Body", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 1, "x": 2.1855687037941607e-08, "y": 0, "z": 0 }, "defaultScale": 0.00833799596875906, "defaultTranslation": { "x": 0, "y": -1.2423523766852307e-21, "z": 2.842170943040401e-14 }, "jointIndex": 3, "jointName": "Short02.obj", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 1, "x": 2.1855687037941607e-08, "y": 0, "z": 0 }, "defaultScale": 0.00833799596875906, "defaultTranslation": { "x": 0, "y": -1.2423523766852307e-21, "z": 2.842170943040401e-14 }, "jointIndex": 4, "jointName": "High-poly.obj", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 1, "x": 2.1855687037941607e-08, "y": 0, "z": 0 }, "defaultScale": 0.00833799596875906, "defaultTranslation": { "x": 0, "y": -1.2423523766852307e-21, "z": 2.842170943040401e-14 }, "jointIndex": 5, "jointName": "Eyebrow012.obj", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 1, "x": 2.1855687037941607e-08, "y": 0, "z": 0 }, "defaultScale": 0.00833799596875906, "defaultTranslation": { "x": 0, "y": -1.2423523766852307e-21, "z": 2.842170943040401e-14 }, "jointIndex": 6, "jointName": "Eyelashes01.obj", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 1, "x": 2.1855687037941607e-08, "y": 0, "z": 0 }, "defaultScale": 0.00833799596875906, "defaultTranslation": { "x": 0, "y": -1.2423523766852307e-21, "z": 2.842170943040401e-14 }, "jointIndex": 7, "jointName": "Teeth_base.obj", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 1, "x": 2.1855687037941607e-08, "y": 0, "z": 0 }, "defaultScale": 0.00833799596875906, "defaultTranslation": { "x": 0, "y": -1.2423523766852307e-21, "z": 2.842170943040401e-14 }, "jointIndex": 8, "jointName": "Tongue01.obj", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 1, "x": 2.1855687037941607e-08, "y": 0, "z": 0 }, "defaultScale": 0.00833799596875906, "defaultTranslation": { "x": 0, "y": -1.2423523766852307e-21, "z": 2.842170943040401e-14 }, "jointIndex": 9, "jointName": "Male_casualsuit01.obj", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 1, "x": 2.1855687037941607e-08, "y": 0, "z": 0 }, "defaultScale": 0.00833799596875906, "defaultTranslation": { "x": 0, "y": -1.2423523766852307e-21, "z": 2.842170943040401e-14 }, "jointIndex": 10, "jointName": "Shoes02.obj", "parentIndex": -1 }, { "boneType": 2, "defaultRotation": { "w": 1, "x": 2.1855695919725804e-08, "y": 0, "z": 0 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 0, "y": 0, "z": 0 }, "jointIndex": 11, "jointName": "Sean", "parentIndex": -1 }, { "boneType": 1, "defaultRotation": { "w": 1, "x": 6.566580168509972e-08, "y": 0, "z": 0 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 0, "y": 97.34617614746094, "z": -6.238304138183594 }, "jointIndex": 12, "jointName": "Hips", "parentIndex": 11 }, { "boneType": 1, "defaultRotation": { "w": -1.1920928955078125e-07, "x": 4.3711374075883214e-08, "y": -2.1954413398361794e-08, "z": 1 }, "defaultScale": 0.8335038423538208, "defaultTranslation": { "x": -11.463000297546387, "y": -0.4239959716796875, "z": 1.4565830497303978e-07 }, "jointIndex": 13, "jointName": "RightUpLeg", "parentIndex": 12 }, { "boneType": 1, "defaultRotation": { "w": -1.201407826556533e-07, "x": 2.901457207826752e-08, "y": -2.739220050784752e-08, "z": 1 }, "defaultScale": 0.8335038423538208, "defaultTranslation": { "x": 0.0001926422119140625, "y": 42.90468215942383, "z": 4.4035459723090753e-07 }, "jointIndex": 14, "jointName": "RightLeg", "parentIndex": 13 }, { "boneType": 1, "defaultRotation": { "w": -0.0006238443311303854, "x": -0.0002933321229647845, "y": 0.5535721182823181, "z": 0.8328009843826294 }, "defaultScale": 0.8335039019584656, "defaultTranslation": { "x": -2.193450927734375e-05, "y": 42.898109436035156, "z": -7.977650966495275e-07 }, "jointIndex": 15, "jointName": "RightFoot", "parentIndex": 14 }, { "boneType": 1, "defaultRotation": { "w": -0.00013222580309957266, "x": -0.0001285343460040167, "y": 0.7305158972740173, "z": 0.6828956604003906 }, "defaultScale": 0.8335039019584656, "defaultTranslation": { "x": 0.0002689361572265625, "y": 15.393356323242188, "z": 0.00014543533325195312 }, "jointIndex": 16, "jointName": "RightToeBase", "parentIndex": 15 }, { "boneType": 1, "defaultRotation": { "w": -0.000132268454763107, "x": -0.00012849047197960317, "y": 0.7305159568786621, "z": 0.6828956604003906 }, "defaultScale": 0.8335039019584656, "defaultTranslation": { "x": -9.5367431640625e-07, "y": 7.214406490325928, "z": 4.76837158203125e-07 }, "jointIndex": 17, "jointName": "RightToeBase_end", "parentIndex": 16 }, { "boneType": 1, "defaultRotation": { "w": 1.1920927533992653e-07, "x": 4.3711395392165286e-08, "y": -2.1954416951075473e-08, "z": 1 }, "defaultScale": 0.8335038423538208, "defaultTranslation": { "x": 11.463000297546387, "y": -0.4239959716796875, "z": 1.4565830497303978e-07 }, "jointIndex": 18, "jointName": "LeftUpLeg", "parentIndex": 12 }, { "boneType": 1, "defaultRotation": { "w": 3.351240707161196e-08, "x": 3.493743605531563e-08, "y": -2.7392221824129592e-08, "z": 1 }, "defaultScale": 0.8335038423538208, "defaultTranslation": { "x": -0.00019359588623046875, "y": 42.90468215942383, "z": 1.0148390856556944e-06 }, "jointIndex": 19, "jointName": "LeftLeg", "parentIndex": 18 },
                { "boneType": 1, "defaultRotation": { "w": 0.00040836824337020516, "x": 0.00018986556096933782, "y": 0.5498124361038208, "z": 0.8352880477905273 }, "defaultScale": 0.8335039019584656, "defaultTranslation": { "x": 2.288818359375e-05, "y": 42.898109436035156, "z": -2.847356768143072e-07 }, "jointIndex": 20, "jointName": "LeftFoot", "parentIndex": 19 }, { "boneType": 1, "defaultRotation": { "w": 8.885065471986309e-05, "x": 8.586850890424103e-05, "y": 0.7300804257392883, "z": 0.6833612322807312 }, "defaultScale": 0.8335038423538208, "defaultTranslation": { "x": -0.00026798248291015625, "y": 15.393272399902344, "z": 0.00010204315185546875 }, "jointIndex": 21, "jointName": "LeftToeBase", "parentIndex": 20 }, { "boneType": 1, "defaultRotation": { "w": 8.88791837496683e-05, "x": 8.583897579228505e-05, "y": 0.7300804257392883, "z": 0.6833612322807312 }, "defaultScale": 0.8335038423538208, "defaultTranslation": { "x": 9.5367431640625e-07, "y": 7.21450662612915, "z": -4.76837158203125e-07 }, "jointIndex": 22, "jointName": "LeftToeBase_end", "parentIndex": 21 }, { "boneType": 1, "defaultRotation": { "w": 1, "x": 7.454464423517493e-08, "y": 1.691934430208017e-21, "z": 8.495398336151224e-23 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 0, "y": 8.922004699707031, "z": -1.280932337976992e-07 }, "jointIndex": 23, "jointName": "Spine", "parentIndex": 12 }, { "boneType": 1, "defaultRotation": { "w": 1, "x": 7.396741352749814e-08, "y": -1.1850966552846077e-20, "z": 2.1655858562807051e-19 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 1.6155871338926322e-27, "y": 13.862998962402344, "z": -7.441340130753815e-07 }, "jointIndex": 24, "jointName": "Spine1", "parentIndex": 23 }, { "boneType": 1, "defaultRotation": { "w": 1, "x": 6.78548985888483e-08, "y": -1.1850409175284884e-20, "z": 2.182534140797063e-19 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 0, "y": 13.749008178710938, "z": 2.2161657398100942e-07 }, "jointIndex": 25, "jointName": "Spine2", "parentIndex": 24 }, { "boneType": 1, "defaultRotation": { "w": 1, "x": 6.734190094448422e-08, "y": -2.5334296496383127e-21, "z": 1.980299596267329e-19 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 6.617444900424222e-24, "y": 20.843994140625, "z": 4.600824468070641e-07 }, "jointIndex": 26, "jointName": "Neck", "parentIndex": 25 }, { "boneType": 1, "defaultRotation": { "w": 1, "x": 7.606156771089445e-08, "y": -7.105427357601002e-15, "z": 3.060211544807039e-19 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 6.617444900424222e-24, "y": 9.641998291015625, "z": 1.227554093929939e-06 }, "jointIndex": 27, "jointName": "Head", "parentIndex": 26 }, { "boneType": 1, "defaultRotation": { "w": 0.01325114443898201, "x": -0.012865353375673294, "y": 0.5437945127487183, "z": 0.8390151858329773 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -2.9313013553619385, "y": 3.8870086669921875, "z": 12.368497848510742 }, "jointIndex": 28, "jointName": "orbicularis04.R", "parentIndex": 27 }, { "boneType": 1, "defaultRotation": { "w": 0.013251139782369137, "x": -0.012865355238318443, "y": 0.543794572353363, "z": 0.8390151262283325 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 1.430511474609375e-06, "y": 3.9125595092773438, "z": -1.52587890625e-05 }, "jointIndex": 29, "jointName": "orbicularis04.R_end", "parentIndex": 28 }, { "boneType": 1, "defaultRotation": { "w": -0.013251283206045628, "x": 0.012865552678704262, "y": 0.5437945127487183, "z": 0.8390151262283325 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 2.9312984943389893, "y": 3.8870086669921875, "z": 12.368498802185059 }, "jointIndex": 30, "jointName": "orbicularis04.L", "parentIndex": 27 }, { "boneType": 1, "defaultRotation": { "w": -0.013251278549432755, "x": 0.012865555472671986, "y": 0.543794572353363, "z": 0.8390151262283325 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -1.430511474609375e-06, "y": 3.9125823974609375, "z": 1.52587890625e-05 }, "jointIndex": 31, "jointName": "orbicularis04.L_end", "parentIndex": 30 }, { "boneType": 1, "defaultRotation": { "w": 0.016510121524333954, "x": -0.00827875267714262, "y": 0.7710366249084473, "z": 0.6365228891372681 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": -2.9313013553619385, "y": 3.8870086669921875, "z": 12.368497848510742 }, "jointIndex": 32, "jointName": "orbicularis03.R", "parentIndex": 27 }, { "boneType": 1, "defaultRotation": { "w": 0.016510121524333954, "x": -0.008278749883174896, "y": 0.771036684513092, "z": 0.6365227699279785 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": 4.76837158203125e-07, "y": 3.773509979248047, "z": 4.57763671875e-05 }, "jointIndex": 33, "jointName": "orbicularis03.R_end", "parentIndex": 32 }, { "boneType": 1, "defaultRotation": { "w": -0.01651148498058319, "x": 0.008279722183942795, "y": 0.771036684513092, "z": 0.6365227699279785 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": 2.9312984943389893, "y": 3.8870086669921875, "z": 12.368498802185059 }, "jointIndex": 34, "jointName": "orbicularis03.L", "parentIndex": 27 }, { "boneType": 1, "defaultRotation": { "w": -0.01651148870587349, "x": 0.008279716596007347, "y": 0.771036684513092, "z": 0.6365227699279785 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": 2.384185791015625e-06, "y": 3.773569107055664, "z": 1.52587890625e-05 }, "jointIndex": 35, "jointName": "orbicularis03.L_end", "parentIndex": 34 }, { "boneType": 1, "defaultRotation": { "w": 1, "x": 1.0001767947187545e-07, "y": 0, "z": 3.0620241043242957e-19 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -2.9313013553619385, "y": 3.8870086669921875, "z": 12.368497848510742 }, "jointIndex": 36, "jointName": "RightEye", "parentIndex": 27 }, { "boneType": 1, "defaultRotation": { "w": 1, "x": 1.000176723664481e-07, "y": -1.5407439555097887e-33, "z": 3.0620241043242957e-19 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 0, "y": 500.0000305175781, "z": -1.598818926140666e-07 }, "jointIndex": 37, "jointName": "RightEye_end", "parentIndex": 36 },
                { "boneType": 1, "defaultRotation": { "w": 1, "x": 7.224686271456449e-08, "y": 0, "z": 3.0626419048442963e-19 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 2.9312984943389893, "y": 3.8870086669921875, "z": 12.368498802185059 }, "jointIndex": 38, "jointName": "LeftEye", "parentIndex": 27 }, { "boneType": 1, "defaultRotation": { "w": 1, "x": 7.224686271456449e-08, "y": 0, "z": 3.0626419048442963e-19 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 0, "y": 500.0000305175781, "z": -2.3730535758659244e-07 }, "jointIndex": 39, "jointName": "LeftEye_end", "parentIndex": 38 }, { "boneType": 1, "defaultRotation": { "w": 0.5000002980232239, "x": 0.49999988079071045, "y": -0.49999988079071045, "z": 0.4999998211860657 }, "defaultScale": 0.8337997794151306, "defaultTranslation": { "x": -2.302999973297119, "y": 14.029281616210938, "z": 2.000000476837158 }, "jointIndex": 40, "jointName": "RightShoulder", "parentIndex": 25 }, { "boneType": 1, "defaultRotation": { "w": 0.5000017881393433, "x": 0.49999868869781494, "y": -0.5000007748603821, "z": 0.4999985694885254 }, "defaultScale": 0.8337997794151306, "defaultTranslation": { "x": -6.502584437839687e-05, "y": 16.22066879272461, "z": 0.000244140625 }, "jointIndex": 41, "jointName": "RightArm", "parentIndex": 40 }, { "boneType": 1, "defaultRotation": { "w": 0.5000015497207642, "x": 0.49999940395355225, "y": -0.49999934434890747, "z": 0.4999992847442627 }, "defaultScale": 0.8337997198104858, "defaultTranslation": { "x": 1.0500705684535205e-05, "y": 25.56253433227539, "z": 0.0001220703125 }, "jointIndex": 42, "jointName": "RightForeArm", "parentIndex": 41 }, { "boneType": 1, "defaultRotation": { "w": 0.5224242806434631, "x": 0.5224196910858154, "y": -0.4765242636203766, "z": 0.4765235185623169 }, "defaultScale": 0.8337997198104858, "defaultTranslation": { "x": 1.4433950127568096e-05, "y": 26.560016632080078, "z": 0 }, "jointIndex": 43, "jointName": "RightHand", "parentIndex": 42 }, { "boneType": 1, "defaultRotation": { "w": 0.6491436958312988, "x": 0.6491384506225586, "y": -0.28038614988327026, "z": 0.2803840637207031 }, "defaultScale": 0.8337997198104858, "defaultTranslation": { "x": 2.208538055419922, "y": 4.3502349853515625, "z": 0.050262451171875 }, "jointIndex": 44, "jointName": "RightHandThumb1", "parentIndex": 43 }, { "boneType": 1, "defaultRotation": { "w": 0.6102367043495178, "x": 0.6102321743965149, "y": -0.35723090171813965, "z": 0.3572307229042053 }, "defaultScale": 0.8337998986244202, "defaultTranslation": { "x": -0.000179290771484375, "y": 3.3668441772460938, "z": 0.000244140625 }, "jointIndex": 45, "jointName": "RightHandThumb2", "parentIndex": 44 }, { "boneType": 1, "defaultRotation": { "w": 0.6499266028404236, "x": 0.6499192118644714, "y": -0.2785693407058716, "z": 0.27856698632240295 }, "defaultScale": 0.8337998986244202, "defaultTranslation": { "x": -3.0517578125e-05, "y": 3.9481582641601562, "z": -0.00030517578125 }, "jointIndex": 46, "jointName": "RightHandThumb3", "parentIndex": 45 }, { "boneType": 1, "defaultRotation": { "w": 0.6499267220497131, "x": 0.6499190330505371, "y": -0.27856943011283875, "z": 0.2785669267177582 }, "defaultScale": 0.8337998986244202, "defaultTranslation": { "x": -7.62939453125e-06, "y": 2.988971710205078, "z": -4.57763671875e-05 }, "jointIndex": 47, "jointName": "RightHandThumb3_end", "parentIndex": 46 }, { "boneType": 1, "defaultRotation": { "w": -0.4795624315738678, "x": -0.47955766320228577, "y": 0.5196367502212524, "z": -0.5196365118026733 }, "defaultScale": 0.8337994813919067, "defaultTranslation": { "x": -3.082691192626953, "y": 10.043777465820312, "z": -0.92779541015625 }, "jointIndex": 48, "jointName": "RightHandRing1", "parentIndex": 43 }, { "boneType": 1, "defaultRotation": { "w": -0.4824811816215515, "x": -0.48247531056404114, "y": 0.5169286131858826, "z": -0.5169275999069214 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": 7.200241088867188e-05, "y": 3.2436370849609375, "z": -3.0517578125e-05 }, "jointIndex": 49, "jointName": "RightHandRing2", "parentIndex": 48 }, { "boneType": 1, "defaultRotation": { "w": 0.47932279109954834, "x": 0.4793177843093872, "y": -0.51985764503479, "z": 0.5198578834533691 }, "defaultScale": 0.8337994813919067, "defaultTranslation": { "x": -3.337860107421875e-06, "y": 2.6725616455078125, "z": -0.00048828125 }, "jointIndex": 50, "jointName": "RightHandRing3", "parentIndex": 49 }, { "boneType": 1, "defaultRotation": { "w": 0.4793228209018707, "x": 0.47931766510009766, "y": -0.5198575258255005, "z": 0.5198579430580139 }, "defaultScale": 0.8337994813919067, "defaultTranslation": { "x": 1.049041748046875e-05, "y": 2.8623199462890625, "z": 1.52587890625e-05 }, "jointIndex": 51, "jointName": "RightHandRing3_end", "parentIndex": 50 }, { "boneType": 1, "defaultRotation": { "w": -0.4389411509037018, "x": -0.4389358162879944, "y": 0.5543765425682068, "z": -0.5543760061264038 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -4.734469890594482, "y": 9.049179077148438, "z": -0.0750579833984375 }, "jointIndex": 52, "jointName": "RightHandPinky1", "parentIndex": 43 }, { "boneType": 1, "defaultRotation": { "w": 0.4439527690410614, "x": 0.4439471364021301, "y": -0.550370991230011, "z": 0.5503712892532349 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 8.0108642578125e-05, "y": 2.2759857177734375, "z": 0.0006561279296875 }, "jointIndex": 53, "jointName": "RightHandPinky2", "parentIndex": 52 }, { "boneType": 1, "defaultRotation": { "w": 0.4397892355918884, "x": 0.4397844970226288, "y": -0.5537033081054688, "z": 0.5537036657333374 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 5.7220458984375e-06, "y": 1.6888198852539062, "z": 0.000244140625 }, "jointIndex": 54, "jointName": "RightHandPinky3", "parentIndex": 53 }, { "boneType": 1, "defaultRotation": { "w": 0.439789354801178, "x": 0.4397844672203064, "y": -0.5537033081054688, "z": 0.5537035465240479 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 1.9073486328125e-05, "y": 2.1375961303710938, "z": -1.52587890625e-05 }, "jointIndex": 55, "jointName": "RightHandPinky3_end", "parentIndex": 54 },
                { "boneType": 1, "defaultRotation": { "w": 0.5086357593536377, "x": 0.508630633354187, "y": -0.4912143349647522, "z": 0.49121519923210144 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -1.0654077529907227, "y": 10.92462158203125, "z": -1.1292572021484375 }, "jointIndex": 56, "jointName": "RightHandMiddle1", "parentIndex": 43 }, { "boneType": 1, "defaultRotation": { "w": 0.5055654048919678, "x": 0.5055586099624634, "y": -0.49437421560287476, "z": 0.49437570571899414 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -2.6464462280273438e-05, "y": 3.7032699584960938, "z": -0.0004425048828125 }, "jointIndex": 57, "jointName": "RightHandMiddle2", "parentIndex": 56 }, { "boneType": 1, "defaultRotation": { "w": 0.5092260241508484, "x": 0.5092152953147888, "y": -0.4906056225299835, "z": 0.4906065762042999 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -1.7404556274414062e-05, "y": 2.9242019653320312, "z": 3.0517578125e-05 }, "jointIndex": 58, "jointName": "RightHandMiddle3", "parentIndex": 57 }, { "boneType": 1, "defaultRotation": { "w": 0.5092277526855469, "x": 0.5092147588729858, "y": -0.4906049966812134, "z": 0.49060600996017456 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -4.673004150390625e-05, "y": 2.89202880859375, "z": -0.000213623046875 }, "jointIndex": 59, "jointName": "RightHandMiddle3_end", "parentIndex": 58 }, { "boneType": 1, "defaultRotation": { "w": 0.5318084955215454, "x": 0.5318036079406738, "y": -0.4660274386405945, "z": 0.4660284221172333 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 1.5224924087524414, "y": 11.354156494140625, "z": -0.744842529296875 }, "jointIndex": 60, "jointName": "RightHandIndex1", "parentIndex": 43 }, { "boneType": 1, "defaultRotation": { "w": 0.5354611277580261, "x": 0.5354530811309814, "y": -0.46182844042778015, "z": 0.46182817220687866 }, "defaultScale": 0.8337997198104858, "defaultTranslation": { "x": -3.814697265625e-06, "y": 2.7954254150390625, "z": 0.0003662109375 }, "jointIndex": 61, "jointName": "RightHandIndex2", "parentIndex": 60 }, { "boneType": 1, "defaultRotation": { "w": 0.5247377753257751, "x": 0.5247268676757812, "y": -0.47397884726524353, "z": 0.4739779531955719 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": -1.430511474609375e-05, "y": 2.533355712890625, "z": -0.000640869140625 }, "jointIndex": 62, "jointName": "RightHandIndex3", "parentIndex": 61 }, { "boneType": 1, "defaultRotation": { "w": 0.5247399806976318, "x": 0.524726390838623, "y": -0.4739784598350525, "z": 0.47397753596305847 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": -2.574920654296875e-05, "y": 2.8463287353515625, "z": -0.0001373291015625 }, "jointIndex": 63, "jointName": "RightHandIndex3_end", "parentIndex": 62 }, { "boneType": 1, "defaultRotation": { "w": 0.5000002980232239, "x": 0.49999988079071045, "y": 0.49999988079071045, "z": -0.4999998211860657 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 2.302999973297119, "y": 14.029281616210938, "z": 2.000000476837158 }, "jointIndex": 64, "jointName": "LeftShoulder", "parentIndex": 25 }, { "boneType": 1, "defaultRotation": { "w": 0.5009862184524536, "x": 0.5009829998016357, "y": 0.49901434779167175, "z": -0.4990122318267822 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 6.454900722019374e-05, "y": 16.22066879272461, "z": 0.000244140625 }, "jointIndex": 65, "jointName": "LeftArm", "parentIndex": 64 }, { "boneType": 1, "defaultRotation": { "w": 0.5000016689300537, "x": 0.49999934434890747, "y": 0.4999992847442627, "z": -0.4999992847442627 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -2.1636486053466797e-05, "y": 25.562536239624023, "z": 0.0001068115234375 }, "jointIndex": 66, "jointName": "LeftForeArm", "parentIndex": 65 }, { "boneType": 1, "defaultRotation": { "w": 0.5237998366355896, "x": 0.5237958431243896, "y": 0.47501128911972046, "z": -0.4750109612941742 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": -1.761044404702261e-05, "y": 26.560016632080078, "z": 0 }, "jointIndex": 67, "jointName": "LeftHand", "parentIndex": 66 }, { "boneType": 1, "defaultRotation": { "w": 0.6502906680107117, "x": 0.6502861976623535, "y": 0.27771517634391785, "z": -0.27771204710006714 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -2.2085351943969727, "y": 4.3502655029296875, "z": 0.0502777099609375 }, "jointIndex": 68, "jointName": "LeftHandThumb1", "parentIndex": 67 }, { "boneType": 1, "defaultRotation": { "w": 0.6116456985473633, "x": 0.6116398572921753, "y": 0.35481420159339905, "z": -0.3548138439655304 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -0.000202178955078125, "y": 3.366161346435547, "z": -0.0001068115234375 }, "jointIndex": 69, "jointName": "LeftHandThumb2", "parentIndex": 68 }, { "boneType": 1, "defaultRotation": { "w": 0.6511718034744263, "x": 0.6511655449867249, "y": 0.2756434977054596, "z": -0.27564361691474915 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 2.288818359375e-05, "y": 3.9481277465820312, "z": 0.0001983642578125 }, "jointIndex": 70, "jointName": "LeftHandThumb3", "parentIndex": 69 }, { "boneType": 1, "defaultRotation": { "w": 0.6511717438697815, "x": 0.6511656045913696, "y": 0.2756434977054596, "z": -0.2756436765193939 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -1.9073486328125e-05, "y": 2.9890670776367188, "z": 0 }, "jointIndex": 71, "jointName": "LeftHandThumb3_end", "parentIndex": 70 }, { "boneType": 1, "defaultRotation": { "w": 0.48062509298324585, "x": 0.48062050342559814, "y": 0.518653929233551, "z": -0.5186536312103271 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": 3.0826001167297363, "y": 10.043853759765625, "z": -0.92779541015625 }, "jointIndex": 72, "jointName": "LeftHandRing1", "parentIndex": 67 }, { "boneType": 1, "defaultRotation": { "w": -0.4837009608745575, "x": -0.48369714617729187, "y": -0.515785813331604, "z": 0.5157861709594727 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 3.147125244140625e-05, "y": 3.2437057495117188, "z": -1.52587890625e-05 }, "jointIndex": 73, "jointName": "LeftHandRing2", "parentIndex": 72 },
                { "boneType": 1, "defaultRotation": { "w": -0.4805733263492584, "x": -0.48056912422180176, "y": -0.5187014937400818, "z": 0.5187016129493713 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": -8.58306884765625e-06, "y": 2.672576904296875, "z": -0.0004119873046875 }, "jointIndex": 74, "jointName": "LeftHandRing3", "parentIndex": 73 }, { "boneType": 1, "defaultRotation": { "w": -0.4805733561515808, "x": -0.48056915402412415, "y": -0.5187014937400818, "z": 0.5187015533447266 }, "defaultScale": 0.8337996006011963, "defaultTranslation": { "x": 4.291534423828125e-06, "y": 2.8623199462890625, "z": 3.0517578125e-05 }, "jointIndex": 75, "jointName": "LeftHandRing3_end", "parentIndex": 74 }, { "boneType": 1, "defaultRotation": { "w": -0.43987417221069336, "x": -0.43987128138542175, "y": -0.5536343455314636, "z": 0.5536363124847412 }, "defaultScale": 0.8337994813919067, "defaultTranslation": { "x": 4.734475612640381, "y": 9.049217224121094, "z": -0.0750732421875 }, "jointIndex": 76, "jointName": "LeftHandPinky1", "parentIndex": 67 }, { "boneType": 1, "defaultRotation": { "w": 0.4450058937072754, "x": 0.44500255584716797, "y": 0.5495191216468811, "z": -0.5495189428329468 }, "defaultScale": 0.8337994813919067, "defaultTranslation": { "x": -8.7738037109375e-05, "y": 2.2759857177734375, "z": 0.0006103515625 }, "jointIndex": 77, "jointName": "LeftHandPinky2", "parentIndex": 76 }, { "boneType": 1, "defaultRotation": { "w": 0.4409898519515991, "x": 0.44098588824272156, "y": 0.5527476072311401, "z": -0.5527472496032715 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": -5.7220458984375e-06, "y": 1.688873291015625, "z": 0.000213623046875 }, "jointIndex": 78, "jointName": "LeftHandPinky3", "parentIndex": 77 }, { "boneType": 1, "defaultRotation": { "w": 0.4409898519515991, "x": 0.44098588824272156, "y": 0.5527476072311401, "z": -0.5527472496032715 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": -3.814697265625e-06, "y": 2.1376190185546875, "z": 1.52587890625e-05 }, "jointIndex": 79, "jointName": "LeftHandPinky3_end", "parentIndex": 78 }, { "boneType": 1, "defaultRotation": { "w": 0.509987473487854, "x": 0.5099828839302063, "y": 0.48981064558029175, "z": -0.4898114502429962 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": 1.0654120445251465, "y": 10.924652099609375, "z": -1.1292572021484375 }, "jointIndex": 80, "jointName": "LeftHandMiddle1", "parentIndex": 67 }, { "boneType": 1, "defaultRotation": { "w": 0.5069082379341125, "x": 0.5069022178649902, "y": 0.4929971694946289, "z": -0.49299824237823486 }, "defaultScale": 0.8337994813919067, "defaultTranslation": { "x": -7.867813110351562e-06, "y": 3.7032699584960938, "z": -0.000457763671875 }, "jointIndex": 81, "jointName": "LeftHandMiddle2", "parentIndex": 80 }, { "boneType": 1, "defaultRotation": { "w": 0.5105096697807312, "x": 0.5105005502700806, "y": 0.48926860094070435, "z": -0.4892692565917969 }, "defaultScale": 0.8337993025779724, "defaultTranslation": { "x": 9.5367431640625e-06, "y": 2.9242401123046875, "z": 7.62939453125e-05 }, "jointIndex": 82, "jointName": "LeftHandMiddle3", "parentIndex": 81 }, { "boneType": 1, "defaultRotation": { "w": 0.5105125904083252, "x": 0.5104998350143433, "y": 0.4892679750919342, "z": -0.4892686605453491 }, "defaultScale": 0.8337993025779724, "defaultTranslation": { "x": 3.886222839355469e-05, "y": 2.8920364379882812, "z": -0.00018310546875 }, "jointIndex": 83, "jointName": "LeftHandMiddle3_end", "parentIndex": 82 }, { "boneType": 1, "defaultRotation": { "w": 0.5334433913230896, "x": 0.532853364944458, "y": 0.4648272693157196, "z": -0.46415573358535767 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": -1.5224857330322266, "y": 11.354194641113281, "z": -0.744842529296875 }, "jointIndex": 84, "jointName": "LeftHandIndex1", "parentIndex": 67 }, { "boneType": 1, "defaultRotation": { "w": 0.5369055867195129, "x": 0.5368989706039429, "y": 0.46014729142189026, "z": -0.4601474702358246 }, "defaultScale": 0.8337995409965515, "defaultTranslation": { "x": -1.1444091796875e-05, "y": 2.7954254150390625, "z": 0.000396728515625 }, "jointIndex": 85, "jointName": "LeftHandIndex2", "parentIndex": 84 }, { "boneType": 1, "defaultRotation": { "w": 0.5261635780334473, "x": 0.5261550545692444, "y": 0.47239387035369873, "z": -0.47239384055137634 }, "defaultScale": 0.8337993621826172, "defaultTranslation": { "x": 3.814697265625e-06, "y": 2.533416748046875, "z": -0.0005645751953125 }, "jointIndex": 86, "jointName": "LeftHandIndex3", "parentIndex": 85 }, { "boneType": 1, "defaultRotation": { "w": 0.5261648297309875, "x": 0.5261549949645996, "y": 0.4723937213420868, "z": -0.472393661737442 }, "defaultScale": 0.8337993621826172, "defaultTranslation": { "x": -1.9073486328125e-06, "y": 2.846405029296875, "z": -4.57763671875e-05 }, "jointIndex": 87, "jointName": "LeftHandIndex3_end", "parentIndex": 86 }
            ],
            /* eslint-enable max-len, array-element-newline, @typescript-eslint/no-loss-of-precision */
            traitStatuses,
            initialSend: false
        });
        packetList.closeCurrentPacket();

        expect(packetList instanceof NLPacketList).toBe(true);
        expect(packetList.getType()).toBe(PacketType.SetAvatarTraits);
        const NUM_PACKETS = 3;
        const PACKET_HEADER_SIZE = 32;
        expect(packetList.getDataSize()).toBe(NUM_PACKETS * PACKET_HEADER_SIZE + EXPECTED_MESSAGE.length / 2);
        const packets = packetList.getPackets();
        expect(packets).toHaveLength(3);  // eslint-disable-line @typescript-eslint/no-magic-numbers

        let packet = packets[0];
        let packetSize = packet.getDataSize();
        expect(packetSize).toBeGreaterThan(0);
        expect(packetSize).toBeLessThanOrEqual(UDT.MAX_PACKET_SIZE);
        expect(buffer2hex(packet.getMessageData().buffer.slice(0, packet.getMessageData().dataPosition)))
            .toBe(EXPECTED_PACKET_0);
        expect(packet.getMessageData().dataPosition).toBe(EXPECTED_PACKET_0.length / 2);

        packet = packets[1];
        packetSize = packet.getDataSize();
        expect(packetSize).toBeGreaterThan(0);
        expect(packetSize).toBeLessThanOrEqual(UDT.MAX_PACKET_SIZE);
        expect(buffer2hex(packet.getMessageData().buffer.slice(0, packet.getMessageData().dataPosition)))
            .toBe(EXPECTED_PACKET_1);
        expect(packet.getMessageData().dataPosition).toBe(EXPECTED_PACKET_1.length / 2);

        packet = packets[2];
        packetSize = packet.getDataSize();
        expect(packetSize).toBeGreaterThan(0);
        expect(packetSize).toBeLessThanOrEqual(UDT.MAX_PACKET_SIZE);
        expect(buffer2hex(packet.getMessageData().buffer.slice(0, packet.getMessageData().dataPosition)))
            .toBe(EXPECTED_PACKET_2);
        expect(packet.getMessageData().dataPosition).toBe(EXPECTED_PACKET_2.length / 2);
    });

});
